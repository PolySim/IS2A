title: "TP2"
author: "Simon Desdevises"
date: "2025-09-19"
output: html_document
---

# Question 1

```{r load_data}
data <- read.csv("/Users/simondesdevises/Documents/Polytech/IS2A/S7/stat_exploratoire/TP2/Temperatures.csv", header = TRUE) # nolint
rownames(data) <- data$X
data <- data[, -1]

```

# Question 2

Les données représentent les températures sur les différents mois de l'année pour différentes villes. \
On y retrouve en plus les données `"Moyenne","Amplitude","Latitude","Longitude","Region"`.

# Question 3

```{r normalize_data}
data_formatted <- data[, 1:(ncol(data) - 5)]
data_formatted <- scale(data_formatted, center = TRUE, scale = TRUE)
data_formatted
```

# Question 4

```{r variance_covariance}
n <- nrow(data_formatted)
var_cov_matrix <- (1 / (n - 1)) * t(data_formatted) %*% data_formatted
var_cov_matrix
```

Nous avons une matrice diagonale.

# Question 5

```{r valeur_propre}
eigen_result <- eigen(var_cov_matrix)

cat("Valeurs propres :\n")
eigen_result$values

cat("\nVecteurs propres :\n")
eigen_result$vectors
```

# Question 6

```{r contributions_relatives}
valeurs_propres <- eigen_result$values
contributions_relatives <- (valeurs_propres / sum(valeurs_propres))
contributions_cumulees <- cumsum(contributions_relatives)

cat("Contributions relatives de chaque axe (en %) :\n")
for (i in seq_along(contributions_relatives)) {
  cat("Axe", i, ":", round(contributions_relatives[i] * 100, 2), "%\n")
}
```

```{r graphiques_valeurs_propres}
par(mfrow = c(2, 2))

# 1. Coude
barplot(contributions_relatives,
        main = "Contributions relatives (%)",
        xlab = "Composantes",
        ylab = "Pourcentage de variance",
        names.arg = paste("CP", seq_along(contributions_relatives)))

# 2. Kaiser
plot(seq_along(valeurs_propres), valeurs_propres,
     type = "b",
     main = "Scree Plot (Éboulis)",
     xlab = "Composantes",
     ylab = "Valeurs propres",
     pch = 19,
     col = "blue")
abline(h = 1, col = "red", lty = 2, lwd = 2)

# 3. Courbe des contributions cumulées
plot(seq_along(contributions_cumulees), contributions_cumulees * 100,
     type = "b",
     main = "Contributions cumulées",
     xlab = "Nombre de composantes",
     ylab = "Pourcentage cumulé",
     pch = 19,
     col = "green",
     ylim = c(0, 100))
abline(h = 70, col = "red", lty = 2, lwd = 2)  # Seuil de 70%
abline(h = 90, col = "orange", lty = 2, lwd = 2)  # Seuil de 90%

par(mfrow = c(1, 1))
```

On garde les 2 premiers axes si on se base sur le coude ou kaiser.

# Question 7

```{r coordonnees_indiv}
coordonnees_individus <- data_formatted %*% eigen_result$vectors
coordonnees_individus[, 1:3]
```

```{r plans_factoriels_base}
par(mfrow = c(2, 2))

# CP1 vs CP2
plot(coordonnees_individus[, 1], coordonnees_individus[, 2],
     xlab = paste("CP1 (", round(contributions_relatives[1] * 100, 1), "% de la variance)", sep = ""), # nolint
     ylab = paste("CP2 (", round(contributions_relatives[2] * 100, 1), "% de la variance)", sep = ""), # nolint
     main = "CP1 vs CP2",
     pch = 19,
     col = "blue",
     cex = 1.2)
abline(h = 0, v = 0, lty = 2, col = "gray")

# CP1 vs CP3
plot(coordonnees_individus[, 1], coordonnees_individus[, 3],
     xlab = paste("CP1 (", round(contributions_relatives[1] * 100, 1), "% de la variance)", sep = ""), # nolint
     ylab = paste("CP3 (", round(contributions_relatives[3] * 100, 1), "% de la variance)", sep = ""), # nolint
     main = "CP1 vs CP3",
     pch = 19,
     col = "red",
     cex = 1.2)
abline(h = 0, v = 0, lty = 2, col = "gray")

# CP2 vs CP3
plot(coordonnees_individus[, 2], coordonnees_individus[, 3],
     xlab = paste("CP2 (", round(contributions_relatives[2] * 100, 1), "% de la variance)", sep = ""), # nolint
     ylab = paste("CP3 (", round(contributions_relatives[3] * 100, 1), "% de la variance)", sep = ""), # nolint
     main = "CP2 vs CP3",
     pch = 19,
     col = "green",
     cex = 1.2)
abline(h = 0, v = 0, lty = 2, col = "gray")

par(mfrow = c(1, 1))
```

# Question 8 

```{r contributions_individus}
n_individus <- nrow(coordonnees_individus)
valeurs_propres <- eigen_result$values

# Contributions pour les 3 premiers axes
contributions <- matrix(0, nrow = n_individus, ncol = 3)
rownames(contributions) <- rownames(coordonnees_individus)
colnames(contributions) <- c("CP1", "CP2", "CP3")

for (i in 1:3) {
  contributions[, i] <- (coordonnees_individus[, i]^2 / (valeurs_propres[i] * (n_individus - 1))) # nolint: line_length_linter.
}

round(contributions * 100, 2)
```

```{r qualite_contributions_individus}
distances_carrees <- rowSums(coordonnees_individus^2)

qualite_repr <- matrix(0, nrow = n_individus, ncol = 3)
rownames(qualite_repr) <- rownames(coordonnees_individus)
colnames(qualite_repr) <- c("cos2_CP1", "cos2_CP2", "cos2_CP3")

for (i in 1:3) {
  qualite_repr[, i] <- coordonnees_individus[, i]^2 / distances_carrees
}

cat("Qualité de représentation des individus sur les 3 premiers axes :\n")
round(qualite_repr, 3)

qualite_cumulee_cp1_cp2 <- qualite_repr[, 1] + qualite_repr[, 2]

cat("\nQualité de représentation cumulée sur CP1 + CP2 :\n")
round(qualite_cumulee_cp1_cp2, 3)

# Qualité de représentation cumulée sur les 3 premiers axes
qualite_cumulee_cp1_cp2_cp3 <- qualite_repr[, 1] + qualite_repr[, 2] + qualite_repr[, 3] # nolint: line_length_linter.

cat("\nQualité de représentation cumulée sur CP1 + CP2 + CP3 :\n")
round(qualite_cumulee_cp1_cp2_cp3, 3)
```

```{r analyse_individus_remarquables}
# 1. Individus les plus contributeurs sur CP1
contrib_cp1_tries <- sort(contributions[, 1], decreasing = TRUE)
contrib_cp1_tries * 100

# 2. Individus les plus contributeurs sur CP2
contrib_cp2_tries <- sort(contributions[, 2], decreasing = TRUE)
contrib_cp2_tries * 100

# 3. Individus les plus contributeurs sur CP3
contrib_cp3_tries <- sort(contributions[, 3], decreasing = TRUE)
contrib_cp3_tries * 100
```

# Question 9

```{r coordonnees_variables}
coor_variables <- eigen_result$vectors %*% diag(sqrt(eigen_result$values))

round(coor_variables[, 1:3], 3)
```