---
title: "TP1"
author: "Simon Desdevises"
date: "2025-09-15"
output: html_document
---

# Analyse descriptive

The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models).

```{r print_mtcars, echo=FALSE, fig.width=12, fig.height=4}
plot(mtcars$hp, mtcars$mpg,
     xlab = "Puissance",
     ylab = "Consommation",
     main = "Consommation de carburant en fonction de la puissance",
     pch = 19,
     col = "blue")
```

```{r calc_modele_8, eval=FALSE}
# Nombre de modèles de voitures ayant 8 cylindres
sum(mtcars$cyl == 8)
```

# 2 Analyse des corrélations linéaires

## 2.2

### 2.2.1 Calcul des corrélations

#### Question 1

```{r calc_correlations_mpg_wt}
moy_mpg <- mean(mtcars$mpg)
moy_wt <- mean(mtcars$wt)

numerator <- sum((mtcars$mpg - moy_mpg) * (mtcars$wt - moy_wt))
denominator <- sqrt(sum((mtcars$mpg - moy_mpg)^2) * sum((mtcars$wt - moy_wt)^2))
cor_mpg_wt <- numerator / denominator
cor_mpg_wt
```

#### Question 2

Le coefficient de corrélation linéaire est de -0.8676594. Il est proche de -1, ce qui signifie que les variables sont fortement corrélées.
Plus la voiture est lourde, plus la consommation est faible.

#### Question 3

```{r cor.test_mpg_wt}
cor.test(mtcars$mpg, mtcars$wt, conf.level = 0.95)
```

### 2.2.2 Calcul des matrices de corrélations

#### Question 1 

```{r matrice_correlation_complete}
matrice_cor <- cor(mtcars)
matrice_cor
```

La matrice n'est pas très lisible :

- On a une matrice 11x11 soit 121 valeurs
- Beaucoup de chiffres significatifs

Pour améliorer la lisibilité, nous pouvons arrondir les coefficients à 2 décimales.

#### Question 2

```{r print_matrice_corplte}
library(corrplot)
corrplot(matrice_cor, method = "circle", type = "lower")
```

#### Question 3

```{r test_code_2.2.2_3}
library(psych)
cor.matrix <- corr.test(mtcars)
corrplot(cor.matrix$r, p.mat = cor.matrix$p, insig = "p-value", order = "AOE")
```

Les données sont triées.

# 3 Régression Linéaire

## 3.2 Questions

### 1 

#### a

```{r modele_linear_regression_multiple_mpg_wt_hp_drat}
modele_multiple <- lm(mpg ~ wt + hp + drat, data = mtcars)
```

#### b

```{r coef_linear_regression_multiple_mpg_wt_hp_drat}
coef <- modele_multiple$coefficients
coef
```

### 2

#### a

```{r coef_determination_linear_regression_multiple_mpg_wt_hp_drat}
predicted_mpg <- predict(modele_multiple)
moy_mpg <- mean(mtcars$mpg)
numerator <- sum((mtcars$mpg - predicted_mpg)^2)
denominator <- sum((mtcars$mpg - moy_mpg)^2)
r2 <- 1 - (numerator / denominator)
r2
```

```{r coef_determination_corrigé_linear_regression_multiple_mpg_wt_hp_drat}
numerator <- (1 - r2) * (length(mtcars$mpg) - 1)
denominator <- length(mtcars$mpg) - 3 - 1
r2_correct <- 1 - (numerator / denominator)
r2_correct
```

#### b

Le coefficient est grand, proche de 1, ce qui signifie que les variables sont fortement corrélées.

### 3

#### a

```{r test_coefficients_regression}
summary_modele <- summary(modele_multiple)

coefficients_table <- summary_modele$coefficients

cat("1. wt :\n")
cat("p-value :", coefficients_table["wt", "Pr(>|t|)"], "\n")
if (coefficients_table["wt", "Pr(>|t|)"] < 0.05) {
  cat("SIGNIFICATIF\n")
} else {
  cat("NON SIGNIFICATIF\n")
}

cat("2. hp :\n")
cat("p-value :", coefficients_table["hp", "Pr(>|t|)"], "\n")
if (coefficients_table["hp", "Pr(>|t|)"] < 0.05) {
  cat("SIGNIFICATIF\n")
} else {
  cat("NON SIGNIFICATIF\n")
}

cat("3. drat :\n")
cat("p-value :", coefficients_table["drat", "Pr(>|t|)"], "\n")
if (coefficients_table["drat", "Pr(>|t|)"] < 0.05) {
  cat("SIGNIFICATIF\n")
} else {
  cat("NON SIGNIFICATIF\n")
}
```

#### b

La donnée wt est la plus significative car il y a la plus petite p-value. Cela est tout à fait logique.

### 4

#### a

```{r stat_F}
stat_f <- summary_modele$fstatistic
cat("Hypothèses :\n")

p_value_f <- pf(stat_f[1], stat_f[2], stat_f[3], lower.tail = FALSE)
cat("p-value du test F :", p_value_f, "\n\n")

if (p_value_f < 0.05) {
  cat("rejet - signifiant\n")
} else {
  cat("non rejet - non signifiant\n")
}
```

#### b

Le modèle est signifiant. On peut donc l'utiliser pour faire des prédictions.

### 5

#### a

On peut utiliser les variables `am`, `vs`, `cyl`

#### b

```{r calcul_residus}
residus <- residuals(modele_multiple)

qqnorm(residus,
       main = "Normal résidus",
       pch = 19,
       col = "blue")
```

```{r test_shapiro}
test_shapiro <- shapiro.test(residus)

cat("p-value :", test_shapiro$p.value, "\n")

if (test_shapiro$p.value > 0.05) {
  cat("L'hypothèse de normalité est respectée.\n")
} else {
  cat("L'hypothèse de normalité n'est pas respectée.\n")
}
```