---
title: "Rapport TP7"
author: "Antonin"
date: "2025-10-06"
output: html_document
---

```{r, imports}
library(FactoMineR)
library(factoextra)
library(corrplot)
```

```{r}
data <- readRDS(file = "Soils.RDS")
donnees <- readRDS(file = "Soils.RDS")
donnees <- as.data.frame(donnees)
data <- as.data.frame(data)
data <- subset(data, select = -c(Contour, Depth)) 
data
```

```{r}
# Si ton dataframe contient plusieurs colonnes num√©riques :
boxplot(donnees, 
        main = "Boxplot de toutes les variables", 
        col = "lightblue", 
        las = 2)  # las=2 pour les noms en diagonale

```




```{r}
data_scale <- scale(data)
acp <- PCA(data_scale, graph = FALSE)
```


```{r}
acp$eig[,1]
```


```{r}
fviz_eig(acp, addlabels = TRUE)
```

Le critere du coude et de variance cumul√©e nous indiquent de prendre seulement les deux premiers axes, le critere de kaiser nous indique de prendre seulement le premier axe mais cela nest pas possible pour les analyses a suivre.

```{r}
fviz_contrib(acp, choice = "var", axes = 1)
fviz_contrib(acp, choice = "var", axes = 2) 
```

La ligne rouge pointill√©e repr√©sente le seuil de contribution moyenne (environ 11,1% si vous avez 9 variables, soit 100%/9).

Variables contribuant le plus (au-dessus du seuil) (dim 1):

Conduc. (~18%) : contribution la plus forte
Na (~17%)
N (~16%)
Ca (~15%)
Dens (~13%)
P (~12%)

La Dim-1 est principalement d√©finie par des variables li√©es √† la composition chimique et physique de vos donn√©es (conductivit√©, sodium, azote, calcium, densit√©, phosphore). C'est probablement un axe de min√©ralisation/composition ionique.

Variable dominant largement (dim 2) :

Mg (Magn√©sium) : ~72% de contribution ! C'est √©norme et tr√®s inhabituel.

Les autres variables contribuent tr√®s faiblement (<10% chacune).
Interpr√©tation : La Dim-2 est quasi-exclusivement d√©finie par le Mg. Cet axe repr√©sente essentiellement la variabilit√© du magn√©sium dans vos √©chantillons.
Conclusion pr√©liminaire

Dim-1 : axe "multivariable" refl√©tant la composition g√©n√©rale
Dim-2 : axe "sp√©cifique" au magn√©sium

Cette forte domination du Mg sur Dim-2 sugg√®re que cette variable a un comportement tr√®s ind√©pendant des autres.


```{r}
fviz_contrib(acp, choice = "ind", axes = 1)
fviz_contrib(acp, choice = "ind", axes = 2) 
```

Contribution des individus √† Dim-1
Observations :

Distribution relativement homog√®ne et d√©croissante
Les premiers individus (S33, S35, S38, S7, S21...) contribuent entre 7% et 4%
La ligne rouge (seuil moyen ~2%) montre qu'environ la moiti√© des individus contribuent au-dessus de la moyenne
D√©croissance progressive, pas de rupture brutale

Interpr√©tation :

La Dim-1 est construite par plusieurs individus de mani√®re √©quilibr√©e
Aucun individu extr√™me ne domine l'axe
Cela sugg√®re une variabilit√© naturelle et continue de la composition chimique dans votre √©chantillon
Les individus comme S33, S35, S38 sont les plus typiques/extr√™mes sur cet axe

Contribution des individus √† Dim-2
Observations :

S2 domine massivement avec ~12% de contribution (presque 6√ó la moyenne !)
Suivi par S36, S33, S35, S28 (6-7%)
D√©croissance tr√®s rapide apr√®s les premiers individus
Beaucoup d'individus contribuent tr√®s faiblement (<1%)

Interpr√©tation :

La Dim-2 est fortement influenc√©e par quelques individus atypiques, particuli√®rement S2
Rappel : Dim-2 = axe du Mg ‚Üí S2 a probablement une concentration en Mg tr√®s particuli√®re (tr√®s haute ou tr√®s basse)
Cette structure confirme que le Mg a un comportement sp√©cifique port√© par quelques √©chantillons

Ensembles des individus ayant une contribution notable:
1,2,3,4,5,9,11,13,14,15,16,17,18,19,20,21,24,27,29,30,31,32,33,34,36,38,41,45,46,47,48
```{r}
fviz_cos2(acp, choice = "var", axes = 1)
fviz_cos2(acp, choice = "var", axes = 2)
```
Cos¬≤ des variables sur Dim-1
Variables bien repr√©sent√©es (Cos¬≤ √©lev√©) :

Conduc. (~0.92) : excellente repr√©sentation
Na (~0.88)
N (~0.87)
Ca (~0.85)
Dens (~0.78)
P (~0.73)

Variables moins bien repr√©sent√©es :

pH (~0.64)
K (~0.63)
Mg (~0.35) : mal repr√©sent√© sur Dim-1

Interpr√©tation :

La Dim-1 repr√©sente tr√®s bien la majorit√© des variables (Conduc., Na, N, Ca, Dens, P)
Le Mg est tr√®s peu corr√©l√© avec Dim-1, ce qui est coh√©rent avec son r√¥le sur Dim-2

Cos¬≤ des variables sur Dim-2
Variable excellemment repr√©sent√©e :

Mg (~0.65) : de loin la mieux repr√©sent√©e

Toutes les autres variables :

K (~0.08), pH (~0.06), Ca (~0.05), P (~0.02), etc.
Cos¬≤ tr√®s faibles ‚Üí tr√®s mal repr√©sent√©es sur Dim-2

Interpr√©tation :

La Dim-2 est presque exclusivement l'axe du Mg
Les autres variables n'ont pratiquement aucune corr√©lation avec cet axe

si on fait la somme des cos2 des deux axes ont obtiens 0.9 ou plus pour toutes les variables mise a part K et pH.

```{r}
fviz_cos2(acp, choice = "ind", axes = 1)
fviz_cos2(acp, choice = "ind", axes = 2)
```


Cos¬≤ des individus sur Dim-1
Observations :

Majorit√© des individus tr√®s bien repr√©sent√©s : la plupart ont un Cos¬≤ entre 0.75 et 0.95
Les meilleurs : S33, S35, S38, S34, S7... (Cos¬≤ > 0.90)
D√©croissance progressive vers la fin
Quelques individus moins bien repr√©sent√©s en fin de graphique (Cos¬≤ < 0.50)

Interpr√©tation :

La grande majorit√© des √©chantillons sont excellemment projet√©s sur Dim-1
Cela confirme que Dim-1 capture bien la variabilit√© principale de vos donn√©es
Les individus avec Cos¬≤ faible ont probablement leur variabilit√© expliqu√©e ailleurs (sur Dim-2 ou dimensions suivantes)

Cos¬≤ des individus sur Dim-2
Observations :

S2 extr√™mement bien repr√©sent√© (Cos¬≤ ~0.75) - c'est un outlier majeur !
Quelques autres individus bien repr√©sent√©s : S36, S28, S33, S35, S21 (Cos¬≤ 0.30-0.50)
Majorit√© des individus tr√®s mal repr√©sent√©s sur Dim-2 (Cos¬≤ < 0.20)
D√©croissance tr√®s rapide apr√®s les premiers

Interpr√©tation :

S2 est l'individu qui d√©finit Dim-2 ‚Üí il a une caract√©ristique tr√®s sp√©cifique (tr√®s probablement une teneur en Mg exceptionnelle)
Quelques autres individus (S36, S28...) ont aussi des profils particuliers en Mg
La majorit√© des √©chantillons sont "normaux" sur cet axe

Qualit√© globale de repr√©sentation dans le plan Dim-1 √ó Dim-2
Pour chaque individu, on peut estimer : Cos¬≤ total = Cos¬≤ Dim-1 + Cos¬≤ Dim-2
Exemples d'individus :

S33, S35, S38 : Cos¬≤ Dim-1 ‚âà 0.95-0.98 + Cos¬≤ Dim-2 ‚âà 0.30-0.45 ‚Üí Total > 1.20 ‚úÖ (excellent, mais plafonn√© √† 1.0)
S2 : Cos¬≤ Dim-1 ‚âà 0.10-0.15 + Cos¬≤ Dim-2 ‚âà 0.75 ‚Üí Total ‚âà 0.90 ‚úÖ (bien repr√©sent√©, mais surtout sur Dim-2)
Individus en fin de graphique : faible sur les deux axes ‚Üí repr√©sentation moyenne, leur variabilit√© est peut-√™tre sur Dim-3+

Messages cl√©s

Dim-1 repr√©sente bien la majorit√© des individus ‚Üí c'est l'axe principal de variabilit√©
S2 est un cas particulier qui "tire" Dim-2 ‚Üí c'est un √©chantillon atypique (forte teneur en Mg ?)
Le plan Dim-1 √ó Dim-2 est globalement satisfaisant pour repr√©senter la plupart de vos donn√©es



```{r}
# Plan 1-2
fviz_pca_var(acp, axes = c(1,2), repel = TRUE,select.var = list(names = c("Conduc", "Na", "N", "Ca", "Dens","Mg" ,"P")))

# Plan 1-2
fviz_pca_ind(acp, axes = c(1,2), repel = TRUE, select.ind = list(name =  c(1,2,3,4,5,9,11,13,14,15,16,17,18,19,20,21,24,27,29,30,31,32,33,34,36,38,41,45,46,47,48)))

```

Cercle de corr√©lation des variables
Variance expliqu√©e :

Dim-1 : 72,7% - excellente ! C'est l'axe majeur
Dim-2 : 8,2% - modeste mais significative
Total plan factoriel : 80,9% ‚úÖ Tr√®s bon (>80% est consid√©r√© comme excellent)

Structure des variables :
Groupe 1 - C√¥t√© gauche (coordonn√©es n√©gatives sur Dim-1) :

Na, Dens, Conduc. : fortement corr√©l√©es entre elles (fl√®ches quasi superpos√©es)
Bien repr√©sent√©es, proches du cercle
Interpr√©tation : ces variables √©voluent ensemble ‚Üí axe de salinit√©/min√©ralisation

Groupe 2 - C√¥t√© droit (coordonn√©es positives sur Dim-1) :

Ca, N, P : corr√©l√©es entre elles
Bien repr√©sent√©es
Interpr√©tation : axe des nutriments (azote, phosphore) et calcium

Variable ind√©pendante :

Mg : perpendiculaire √† Dim-1, tr√®s bien projet√© sur Dim-2
Orthogonal aux autres variables ‚Üí ind√©pendance du magn√©sium
Confirme ce qu'on a vu : Mg varie ind√©pendamment de la min√©ralisation g√©n√©rale

Variables moins bien repr√©sent√©es :

K, pH : fl√®ches courtes ‚Üí moins bien projet√©es dans ce plan (variance sur d'autres dimensions)

Interpr√©tation de Dim-1 (72,7%) :
C'est un gradient de min√©ralisation/composition chimique :

Gauche (-) : √©chantillons riches en Na, conductivit√© √©lev√©e, densit√© forte ‚Üí eaux/sols tr√®s min√©ralis√©s
Droite (+) : √©chantillons riches en Ca, N, P ‚Üí profil nutritif/calcique

Interpr√©tation de Dim-2 (8,2%) :
Axe quasi-exclusif du Mg ‚Üí distingue les √©chantillons selon leur teneur en magn√©sium
Graphique des individus
Structure spatiale :
Quadrant sup√©rieur droit (Dim-1+, Dim-2+) :

Individus : 5, 4, 1
Profil : riches en Ca, N, P ET en Mg

Quadrant inf√©rieur droit (Dim-1+, Dim-2-) :

Individus : 33, 2, 3, 34, 19, 36
Profil : riches en Ca, N, P mais pauvres en Mg
Attention : S2 est ici ! Contrairement √† ce qu'on pensait, S2 a un Mg faible (coordonn√©e n√©gative sur Dim-2)

Quadrant sup√©rieur gauche (Dim-1-, Dim-2+) :

Individus : 16, 13, 38, 9, 21, 24
Profil : riches en Na, Conduc., Dens. (min√©ralisation forte) ET riches en Mg

Quadrant inf√©rieur gauche (Dim-1-, Dim-2-) :

Individus : 46, 29, 47, 32, 41, 43, 45, 15, 30, 31, 14, 27, 11
Profil : riches en Na, Conduc., Dens. mais pauvres en Mg
Groupe le plus nombreux

Centre (proche de l'origine) :

Individus : 20, 17, 18, 25, 44, 23, 8, 48
Profil : valeurs moyennes sur toutes les variables

Individus remarquables :

S33, S2, S3 : tr√®s √† droite ‚Üí fortement min√©ralis√©s en Ca/N/P
S34 : extr√™me √† droite ‚Üí le plus riche en Ca/N/P, pauvre en Mg
S16 : extr√™me √† gauche ‚Üí tr√®s riche en Na/Conduc./Dens., riche en Mg
S24 : haut ‚Üí teneur en Mg particuli√®rement √©lev√©e

Synth√®se globale
Votre ACP r√©v√®le deux axes de variabilit√© ind√©pendants :

Axe principal (72,7%) : opposition entre deux profils chimiques

Type "salin" (Na, Conduc., Dens.) ‚Üî Type "nutritif/calcique" (Ca, N, P)


Axe secondaire (8,2%) : variabilit√© du Mg ind√©pendamment du reste

Question contextuelle : Quel est votre domaine d'√©tude ? Eaux naturelles, sols, produits alimentaires ? Cela permettrait d'affiner l'interpr√©tation √©cologique/agronomique/hydrog√©ochimique.


```{r}
donnees_cah <- acp$ind$coord[,1:2]
matrice_dist <- dist(donnees_cah, method = "euclidean")
cah_ward <- hclust(matrice_dist, method = "ward.D2")

plot(cah_ward, main = "Dendrogramme CAH - M√©thode Ward", 
     xlab = "Individus", ylab = "Hauteur", hang = -1)
```
```{r}
plot(cah_ward)
abline(h = 10, col = "red", lty = 2)  # Ligne de coupure
```

```{r}
hcpc <- HCPC(acp, graph = FALSE)
plot(hcpc, choice = "tree")
```

Graphique d'inertie (en haut √† droite)
Ce petit graphique montre le gain d'inertie √† chaque fusion de clusters. Il aide √† d√©terminer le nombre optimal de classes.


```{r}
k <- 3
groupes <- cutree(cah_ward, k = k)
```


```{r}
table(groupes)
```

```{r}
# Plan factoriel des individus avec couleurs selon les groupes
fviz_pca_ind(acp,
             geom.ind = "point",
             col.ind = as.factor(groupes), # couleur selon le groupe
             palette = c("red", "blue", "green"), 
             addEllipses = TRUE,            # ajoute un ellipse autour de chaque groupe
             legend.title = "Groupe",
             repel = TRUE)                  # √©vite le chevauchement des labels

```

Vue d'ensemble
Les 3 classes sont bien s√©par√©es spatialement, ce qui valide la qualit√© de votre classification. Les ellipses de concentration montrent peu de chevauchement.


Caract√©risation des 3 groupes
üî¥ Groupe 1 (rouge) - Droite du graphique
Position : Dim-1 fortement positive (entre +2 et +6), Dim-2 variable (de -2 √† +1)
Profil chimique :

Tr√®s riches en Ca, N, P (c√¥t√© droit du cercle de corr√©lation)
Faibles en Na, Conduc., Dens.
Magn√©sium variable (√©tal√©s sur Dim-2)

Taille du groupe : ~15-18 individus (groupe moyen)
Interpr√©tation : √âchantillons √† profil nutritif/calcique dominant, faible min√©ralisation saline
Individus typiques : 33, 34, 2, 3, 19, 1, 4, 5...

üîµ Groupe 2 (bleu) - Centre
Position : Dim-1 l√©g√®rement n√©gative √† neutre (entre -1 et +1), Dim-2 fortement positive (entre +1 et +3)
Profil chimique :

Composition interm√©diaire sur Dim-1 (ni tr√®s salin, ni tr√®s nutritif)
Tr√®s riches en Mg (coordonn√©es √©lev√©es sur Dim-2)
Valeurs moyennes pour les autres √©l√©ments

Taille du groupe : ~12-15 individus (groupe moyen)
Interpr√©tation : √âchantillons caract√©ris√©s par leur forte teneur en magn√©sium, composition g√©n√©rale √©quilibr√©e
Individus typiques : 24, 9, 21, 38, 13, 16...

üü¢ Groupe 3 (vert) - Gauche du graphique
Position : Dim-1 fortement n√©gative (entre -4 et -1), Dim-2 n√©gative √† neutre (entre -2 et +1)
Profil chimique :

Tr√®s riches en Na, Conduc., Dens. (c√¥t√© gauche du cercle de corr√©lation)
Faibles en Ca, N, P
Pauvres en Mg (majorit√© en Dim-2 n√©gative)

Taille du groupe : ~20-25 individus (le plus grand groupe)
Interpr√©tation : √âchantillons √† forte min√©ralisation saline, faible en nutriments et magn√©sium
Individus typiques : 46, 29, 47, 32, 15, 30, 31, 14, 27, 11...



```{r}
table(groupes, donnees$Contour)
table(groupes, donnees$Depth)
```


```{r}
# Plan factoriel des individus avec couleurs selon les groupes
fviz_pca_ind(acp,
             geom.ind = "point",
             col.ind = as.factor(donnees$Depth), # couleur selon le groupe
             addEllipses = TRUE,            # ajoute un ellipse autour de chaque groupe
             legend.title = "Groupe",
             repel = TRUE)                  # √©vite le chevauchement des labels

```
 √âchantillons superficiels (0-10 cm) :

Se trouvent principalement √† droite (Dim-1 positif)
Profil : riches en Ca, N, P (nutriments)


√âchantillons profonds (60-90 cm) :

Concentr√©s √† GAUCHE (Dim-1 n√©gatif)
Profil : fortement salin (Na, Conduc., Dens. √©lev√©s)


Le reste un peu dispers√©

SYNTHESE GLOBAL:

Observations principales
üìç R√©partition spatiale selon la profondeur
Zone GAUCHE (Dim-1 n√©gatif) - Groupe 3 (profil salin) :

Domin√©e par les profondeurs 30-60 (cyan) et 60-90 (violet)
Quelques points 10-30 (vert)
Tr√®s peu de 0-10 (rouge)

Zone CENTRE (autour de l'origine) - Groupe 2 (profil magn√©sien) :

M√©lange de toutes les profondeurs
Pr√©sence notable de 10-30 (vert) et 30-60 (cyan)
Quelques 0-10 (rouge) et 60-90 (violet)

Zone DROITE (Dim-1 positif) - Groupe 1 (profil nutritif/calcique) :

Fortement domin√©e par 0-10 (rouge) et 10-30 (vert)
Quelques 30-60 (cyan) en transition
Quasi-absence de 60-90 (violet)


Interpr√©tations selon l'axe Dim-1 (gradient de profondeur)
üî¥ √âchantillons superficiels (0-10 cm) :

Se trouvent principalement √† droite (Dim-1 positif)
Profil : riches en Ca, N, P (nutriments)
Interpr√©tation :

Horizon de surface enrichi en mati√®re organique
Accumulation de nutriments (apports biologiques, engrais si sols agricoles)
Zone d'activit√© biologique intense



üü¢ √âchantillons de subsurface (10-30 cm) :

R√©partis partout mais surtout centre-droite
Profil : interm√©diaire √† nutritif
Interpr√©tation :

Horizon de transition
Encore influenc√© par les processus de surface
Variabilit√© selon les sites



üîµ √âchantillons moyens (30-60 cm) :

Largement r√©partis, surtout gauche et centre
Profil : salin √† interm√©diaire
Interpr√©tation :

Zone de transition vers les horizons profonds
D√©but d'accumulation saline ou lessivage des nutriments



üü£ √âchantillons profonds (60-90 cm) :

Concentr√©s √† GAUCHE (Dim-1 n√©gatif)
Profil : fortement salin (Na, Conduc., Dens. √©lev√©s)
Interpr√©tation :

Accumulation de sels en profondeur (lessivage vertical)
Pauvret√© en nutriments organiques
Possiblement nappe phr√©atique sal√©e ou remont√©es capillaires

Lien avec la dimension Mg (Dim-2)
Observation : Les classes de profondeur sont √©tal√©es sur Dim-2 (axe vertical), sans pattern net.
Interpr√©tation :

Le Mg varie ind√©pendamment de la profondeur
Facteurs contr√¥lant le Mg : lithologie/roche-m√®re plut√¥t que processus verticaux
Certains sites ont du Mg en surface, d'autres en profondeur




```{r}
interclass_inertia <- function(X, clusters) {
  n <- nrow(X)
  # Centre global
  center_global <- colMeans(X)
  
  # Inertie totale
  inertie_totale <- sum(rowSums((X - matrix(center_global, n, ncol(X), byrow=TRUE))^2))
  
  # Inertie intra-classe
  inertie_intra <- 0
  for (k in unique(clusters)) {
    Xk <- X[clusters == k, , drop=FALSE]
    ck <- colMeans(Xk)
    inertie_intra <- inertie_intra + sum(rowSums((Xk - matrix(ck, nrow(Xk), ncol(Xk), byrow=TRUE))^2))
  }
  
  # Inertie inter-classe = Totale - Intra
  inertie_inter <- inertie_totale - inertie_intra
  return(inertie_inter)
}
```

```{r}
res_inertie <- sapply(1:10, function(k) {
  clusters <- cutree(cah_ward, k = k)
  interclass_inertia(data, clusters)  # df non standardis√©
})
```

```{r}
plot(1:10, res_inertie, type = "b", pch = 19,
     xlab = "Nombre de classes (k)", 
     ylab = "Inertie inter-classe",
     main = "Inertie inter-classe en fonction du nombre de groupes")
```















